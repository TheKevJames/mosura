{% extends "base.html" %}
{% block title %}Gannt{% endblock %}

{% block content %}
<div class="ui main container">
  <table class="ui celled fixed unstackable structured table">
    <!-- TODO: point at current date -->
    <thead>
      <tr>
        <th colspan="1">Name</th>
        {% for span, disabled, header in schedule.quarter.headers %}
        <th colspan="{{ span }}" {% if disabled %}style="color:gray;"{% endif %}>
          {{ header | dateformat }}
        </th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for assignee, boxes in schedule.aligned.items() %}
      <tr>
        <td>{{ assignee }}</td>
        <!-- TODO: consider allowing concurrent issues -->
        {% for span, issue in boxes %}
          {% if issue %}
          <td colspan="{{ span }}" title="{{ issue.summary }}">
            <a href="{{ settings.jira_domain }}/browse/{{ issue.key }}">{{ issue.key }}</a>
          {% else %}
          <td colspan="{{ span }}">
          {% endif %}
          </td>
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- TODO dedupe with other list pages -->
{% if issues %}
<div class="ui divider"></div>

<div class="ui container">
  <table class="ui celled striped unstackable selectable table">
    <thead class="single line">
      <th>Key</th>
      <th>Summary</th>
      <th>Status</th>
      <th>Assignee</th>
      <th>Priority</th>
      <th>Components</th>
      <th>Labels</th>
    </thead>

    <tbody>
    {% for issue in issues %}
      <tr onclick="location.href='/issues/{{ issue.key }}'">
        <td data-label="Key">{{ issue.key }}</td>
        <td data-label="Summary">{{ issue.summary }}</td>
        <td data-label="Status">{{ issue.status }}</td>
        <td data-label="Assignee">{{ issue.assignee }}</td>
        <td data-label="Priority">{{ issue.priority }}</td>
        <td data-label="Components">
        {% for c in issue.components %}
          <p>{{ c.component }}</p>
        {% endfor %}
        </td>
        <td data-label="Labels">
        {% for l in issue.labels %}
          <p>{{ l.label }}</p>
        {% endfor %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}
{% endblock %}
